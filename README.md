# 온라인 패션 셀렉샵 KKK - KKK 관리 프로그램

![1688810366](https://github.com/user-attachments/assets/c2d896b0-4f05-460e-b9f6-7d81b27b3781)

<br/>


# 프로젝트 소개

- **운영자와 사용자 모두의 관점에서 편하게 이용할 수 있도록 만들어보았습니다.**




✔ [셀렉샵 링크](https://projectkkk.vercel.app/) <br>
✔ [SpreadSyntax 팀 노션 Click!](https://www.notion.so/115791ab9eb88017b3f4e771db6da68f?pvs=4)
<br/><br/>
# ⚙ InfraStructure 

![InfraStructure2](https://user-images.githubusercontent.com/112923814/207117134-890a5ce5-fc20-4b9b-a055-87cf071dd654.jpg)


# ⛓ ERD
<details>
  
<summary><strong> OPEN </strong></summary>
<div markdown="1"> 
1. 시스템의 데이터 구조를 시각적으로 표현</br>
2. 엔터티 간의 관계를 명확히 하여 데이터베이스 구현의 정확성을 높임</br>
3. ER 다이어그램은 팀 간의 소통을 원활</br>
4. 데이터 흐름과 비즈니스 로직을 명확히 정의하는 데 중요한 역할 </br> 
</br>

![KakaoTalk_20241212_230448293](https://github.com/user-attachments/assets/664aed92-f049-40fd-804d-cb78269179d8)

</div>
</details>
</br>

# 🧬API
<details>
  
<summary><strong> OPEN </strong></summary>
<div markdown="1"> 
1. RESTful API 호출 및 클라이언트와 서버 간의 데이터 처리 방법을 명확히 정의</br>
2. 각 API 엔드포인트의 기능, 요청 및 응답 형식, 파라미터 등을 상세히 기술하여 프론트엔드와 백엔드 개발자 간의 효율적인 협업을 촉진</br>
3. 이후 개발 과정에서 SpringDoc를 더 적극적으로 활용</br>
</br>

![KakaoTalk_20241212_230448293](https://github.com/user-attachments/assets/664aed92-f049-40fd-804d-cb78269179d8)

</div>
</details>
✔ [SoppingMall API Click!](https://www.projectkkk.com/swagger-ui/index.html#/)
</br></br></br>


# 🕹 Tech Stack
---

## ✔ Back-end  
<p>
  <img src="https://img.shields.io/badge/Java-007396?style=for-the-badge&logo=java&logoColor=white">
  <img src="https://img.shields.io/badge/Spring Framework-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
  <img src="https://img.shields.io/badge/Spring Security-6DB33F?style=for-the-badge&logo=Spring-Security&logoColor=white">
  <img src="https://img.shields.io/badge/Spring Batch-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
  <img src="https://img.shields.io/badge/JPA-999933?style=for-the-badge&logo=hibernate&logoColor=white">
  <img src="https://img.shields.io/badge/QueryDSL-FFCA28?style=for-the-badge&logo=apachemaven&logoColor=black">
  <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
  <img src="https://img.shields.io/badge/Swagger-85EA2D?style=for-the-badge&logo=swagger&logoColor=black">
  <img src="https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=jsonwebtokens&logoColor=white">
</p>

---

## ✔ Front-end  
<p>
  <img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=html5&logoColor=white">
  <img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=css3&logoColor=white">
  <img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
  <img src="https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=react&logoColor=white">
  <img src="https://img.shields.io/badge/React Router-CA4245?style=for-the-badge&logo=react-router&logoColor=white">
  <img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=axios&logoColor=white">
  <img src="https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white">
</p>

---

## ✔ DevOps  
<p>
  <img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white">
  <img src="https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black">
  <img src="https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazonaws&logoColor=white">
  <img src="https://img.shields.io/badge/GCP-4285F4?style=for-the-badge&logo=googlecloud&logoColor=white">
  <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white">
</p>

---

## ✔ Monitoring & Logs  
<p>
  <img src="https://img.shields.io/badge/Elasticsearch-005571?style=for-the-badge&logo=elasticsearch&logoColor=white">
  <img src="https://img.shields.io/badge/Logstash-005571?style=for-the-badge&logo=elastic&logoColor=white">
  <img src="https://img.shields.io/badge/Kafka-231F20?style=for-the-badge&logo=apachekafka&logoColor=white">
  <img src="https://img.shields.io/badge/Kibana-005571?style=for-the-badge&logo=elastic&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon CloudWatch-FF4F8B?style=for-the-badge&logo=amazoncloudwatch&logoColor=white">
  <img src="https://img.shields.io/badge/Log4j2-FF5733?style=for-the-badge&logo=apache&logoColor=white">

</p>

---

## ✔ Authentication & Security  
<p>
  <img src="https://img.shields.io/badge/OAuth2-3C873A?style=for-the-badge&logo=oauth&logoColor=white">
  <img src="https://img.shields.io/badge/SSL/TLS-008080?style=for-the-badge&logo=letsencrypt&logoColor=white">
</p>

---

## ✔ Database  
<p>
  <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon RDS-527FFF?style=for-the-badge&logo=amazonrds&logoColor=white">

</p>

---

## ✔ API  
<p>
  <img src="https://img.shields.io/badge/REST API-02569B?style=for-the-badge&logo=postman&logoColor=white">
</p>

---

## 📣 Version  
<details>
<summary><strong>버전 정보</strong></summary>
<div markdown="1">
- Java: 17  
- Spring Boot: 3.x  
- MySQL: 8.0  
- Elasticsearch: 8.10.4  
- Docker: 24.0  
</div>
</details>



<details>
<summary><strong>📣기술 & 라이브러리 사용 이유</strong></summary>
<div markdown="1">   
  <br/>
  
<!-- 
|기술 스택| 사용 이유|
|:--|:--|
|Query DSL|현준|
|Full Text Search| 현준 |
|RDS- MySQL| 현준 |
|AWS ElastiCache for Redis| 제윤 |
|Faker| 수영 |
|Github Action| 수영 |
|AWS Elastic Beanstalk| 제윤 |
|Cloud Watch| 제윤 |
|AWS OpenSearch| 제윤 |
|Logback| 수영 |
|Junit 5| 수영 |
|TestContainer|제윤|
|React|제윤| -->

 
  
  <details>
  <summary><strong> 1️⃣ Query DSL</strong></summary>
    <div markdown="1"> 
      
1. 동적인 쿼리 작성이 필요했습니다.
2. 자동 완성 등 IDE의 도움을 받을 수 있어 편리합니다.
3. 문자가 아닌 코드로 쿼리를 작성함으로써, 컴파일 시점에 문법 오류를 쉽게 확인할 수 있어 더욱 안전합니다.
4. 쿼리 작성 시 제약 조건 등을 메서드 추출을 통해 재사용할 수 있었고 가독성이 좋아졌습니다.
      
  </details> 
  
  <details>
  <summary><strong> 2️⃣ Full Text Search</strong></summary>
    <div markdown="1">     
      
  - 대용량 데이터에서 빠른 키워드 조회를 위해 사용했습니다.
      
    </div>
  </details> 
  
  <details>
  <summary><strong> 3️⃣ RDS- MySQL</strong></summary>
    <div markdown="1">     
    <br>
    
- 대용량 데이터를 다루기 때문에 PostgreSQL과 MySQL 사이에서 고민을 했는데 MySQL을 선택한 이유에 대해서 작성해 보았습니다.

1. 프로젝트 전 MySQL을 미리 학습한 경험이 있어 빠르게 마무리해야 하는 프로젝트 특성 상 다른 DB보다 빠르게 프로젝트에 적용이 가능하기 때문에 선택했습니다.
2. 단순 CRUD 시 MySQL의 성능이 조금 더 우수했습니다.
    
    PostgreSQL은 Update시 MySQL과는 다르게 변경 전 값을 삭제 마크처리 후 변경 후 값을 새 행으로 추가하는 방식으로 작업이 진행되기 때문에 Update의 성능이 떨어졌고, Update 기능이 많이 일어나는 프로젝트 특성 상 MySQL을 사용하는 것이 적합하다고 생각했습니다. (그래서 PostgreSQL은 보통 Insert, Select 위주의 서비스에 사용된다고 합니다.)
    

3. 현업에서 MySQL의 점유율 높기 때문에 레퍼런스를 찾기 쉬웠습니다.
    
    PostgreSQL도 4위의 점유율과 급격하게 성장하고 있지만 MySQL은 전 세계 2위의 점유율을 가지고 있고 오랫동안 높은 점유율을 가지고 있기 때문에 개발을 공부하는 입장으로서 많은 레퍼런스들을 참고 할 수 있다는 점에서 선택하였습니다.
   
    </div>
  </details> 
  
    
  <details>
  <summary><strong> 4️⃣ AWS ElastiCache for Redis</strong></summary>
    <div markdown="1">
      1. AWS 아키텍처로 구성된 프로젝트에서 최적화된 서비스와 팀 프로젝트 환경에서 효과적인 모니터링을 위해서 AWS 클라우드 제품을 사용했습니다.
      2. 다양한 데이터 타입과 영속화가 필요했습니다.
    
  </details> 
  
    
  <details>
  <summary><strong> 5️⃣ Faker & SQLAlchemy</strong></summary>
    <div markdown="1">     
      
- 1000만건 상품 데이터를 목표로 하였기 때문에 실제 의류 쇼핑몰 크롤링을 하기에는 무리가 있다고 판단하여 더미데이터 생성을 하기로 결정하였습니다.
- 카테고리별로 다른 상품 이름, 사진을 생성해야 하고, 상품과 주문 생성일자가 Primary key인 id에 따라 증가하도록 데이터를 구성할 수 있어야 하고 생성한 대량의 데이터를 손쉽게 RDS MySQL DB로 보낼 수 있어야 했습니다.
- 파이썬 Faker 라이브러리로 위 조건을 만족하는 더미데이터를 생성했고 Python과 MySQL을 연결시켜주는 라이브러리 mysqlclient를 설치하고 파이썬의 ORM인 SQLAlchemy를 이용하여 생성한 더미데이터 1000만 건을 데이터베이스에 입력했습니다.
    
  </details> 
  
    
    
  <details>
  <summary><strong> 6️⃣ Github Action</strong></summary>
    <div markdown="1">     
    
    - 비용에 문제가 발생하지 않습니다.
    - 클라우드에서 동작하므로 서버 설치가 필요하지 않습니다.
    - Github Repository로 관리하는 프로젝트이기에 호환이 좋고 Github 이벤트(ex. PR) 처리가 가능합니다.
    - GitHub의 완전 관리 서비스이기에 사용이 편리하기에 인프라를 관리하는데 드는 코스트를 낮출 수 있습니다.
      
    </div>
  </details> 
  
    
    
  <details>
  <summary><strong> 7️⃣ AWS Elastic Beanstalk</strong></summary>
    <div markdown="1">
    
<!--  -->
- 다양한 인프라 서비스를 간편하게 사용할 수 있습니다.
< 용량 프로비저닝, 로드 밸런싱, 모니터링, 협업 도구 >
- Github에서 통합이 가능
- 완전 관리형 서비스 사용으로 프로젝트에서 인프라에 사용하는 코스트를 낮출 수 있음
  
    </div>
  </details> 
  
    
    
  <details>
  <summary><strong> 8️⃣ Logback</strong></summary>  
  <div markdown="1">     
  
  - 개발 과정에서 문제 원인 파악 및 개발의 안정성 확보를 위해 콘솔 로그 외의 로그 관리의 필요성을 느꼈습니다.
  - Spring Boot에서 로깅은 대표적으로 Log4j, Logback, Log4j2으로 로그 구현체를 사용합니다.
  - Log4j는 가장 오래된 프레임워크이며 2015년에 단종되었기 때문에 선택지에서 제외하였습니다.
  - Logback은 Log4j를 개발한 개발자가 개발한 Log4j의 후속 버전으로 지속적으로 업데이트되고 있습니다.
  - Log4j2는 가장 최근에 나온 로깅 프레임워크로 logback과 마찬가지로 필터링 기능과 자동 리로드 기능을 가지고 있습니다. logback과의 가장 큰 차이점은 Multi Thread 환경에서 비동기 로거(Async Logger)의 경우 log4j, logback 보다 처리량이 더 높고, 대기 시간이 훨씬 짧습니다. 또한 람다 표현식과 사용자 정의 로그 레벨도 지원합니다.
  - 로깅으로 DB관련 로그, 에러 로그, api 통신 로그를 분리해 파일로 관리하는 것을 목표로 했기 때문에 스프링 기본 설정인 logback 사용을 결정하였습니다.     
  - ConsoleAppender로 Info레벨 이상 로그를 콘솔에 출력,RollingFileAppender로 Debug레벨 이상 DB관련 로그와 Warn레벨 이상 에러로그를 각각 다른 파일로 저장하고
logback-access 모듈을 이용해 api 통신 관련 통신 로그 또한 파일로 저장하여 모니터링하였습니다.
 </div>
  </details> 
  
    
    
  <details>
  <summary><strong> 9️⃣ JUnit5 & Jacoco</strong></summary>
    <div markdown="1">     
      
 - Spring Boot 2.2.0 버전부터 JUnit5가 기본으로 채택되었으며 JUnit4보다 다양한 기능이 제공되어 JUnit5로 테스트 코드를 작성하였습니다.<br/>
 - 컨트롤러 테스트는 @WebMvcTest 어노테이션으로 Web Layer에만 집중하여 테스트하였으며, 서비스 테스트는 모듈 간의 상호작용이 정상적으로 수행되는지 확인하기 위해 통합 테스트를 진행했습니다.<br/>
 - JUnit 테스트 결과를 바탕으로 커버리지를 결과를 리포트해주는 Jacoco 라이브러리를 도입하여 구문 커버리지를 측정하며 안 쓰이는 코드와 어노테이션을 확인하며 리팩토링을 진행하였습니다.
 </div>
  </details> 
  
      
    
  <details>
  <summary><strong> 🔟 TestContainer</strong></summary>
    <div markdown="1">     
    <br>
    
- DB를 사용한 서비스 코드를 어느 환경에서든 바로 테스트가 가능하게 하기 위해서 사용했습니다.

<!--     </div> -->
  </details> 
  
  
</div>
</details>
<br/>


## 🔥 주요 기능

<details> 
<summary><strong> 애플리케이션 미리보기 </strong></summary>
<div markdown="1">      
</br> 
 
| **ELK를 활용한 대시보드 구성** | **메인페이지 랭킹보드** |
| :---: | :---: |
| <img src="https://user-images.githubusercontent.com/112923814/208289007-d9dcc5ad-4b5d-4507-b77a-1285910eb93d.gif" width="70%" height="70%"/> | <img src="https://user-images.githubusercontent.com/112923814/208288878-e6405325-aa81-46f9-a43c-acbd68135c3b.gif" width="70%" height="70%"/> |
| **필터링 검색** | **키워드 검색** |
| <img src="https://user-images.githubusercontent.com/112923814/208288950-e9c3acfb-71c0-468a-a7e7-808f821f9e9f.gif" width="70%" height="70%"/>  | <img src="https://user-images.githubusercontent.com/112923814/208288955-8ca24c79-c5e8-4acb-a928-bab62156b6e4.gif" width="70%" height="70%"/>  |
| **장바구니** | **주문** |
| <img src="https://user-images.githubusercontent.com/112923814/208288959-bf086f38-0c6d-4ccb-b229-52b5a6a1ecfd.gif" width="70%" height="70%"/>  | <img src="https://user-images.githubusercontent.com/112923814/208288954-76a59d7b-2668-4575-862e-80644aa4b6f0.gif" width="70%" height="70%"/>  |
  
</div>
</details>
<br>


### ✔ 주문
  - <details><summary><strong> 📢 동시성 제어 목표값 설정 기준 Click!</strong></summary><div markdown="1"></br><pre><strong>온라인 패션 스토어 무신사가 선보인 패션 특화 라이브 방송 ‘무신사 라이브’ 메종 키츠네 편이 방송 시작 5분 만에 매출 1억 원을 돌파했습니다.</br>동시 상품의 주문으로 가정했을 때 300초 동안 2000건의 주문이 발생한 상황입니다.</strong> (상품 가격 50,000원 기준)</pre></div></details>
  - 대규모 트래픽 상황에서 주문과 재고 데이터의 정합성은 서비스의 신뢰도에 큰 영향을 주고 있습니다.
  - 안정적인 동시성 제어를 위해 목표치를 '무신사 라이브 메종 키츠네 편'의 15배로 설정했습니다.
  - **( 30초 동안 동시 주문 3000건에 대한 정합성 유지 )**

<details>
<summary><strong> 1⃣ Pessimistic Lock으로 동시성 제어</strong></summary>
<div markdown="1">   
<br>

  - 트랜잭션이 시작될 때 MySQL DB에 Exclusive Lock을 걸어 Race Condition을 해결했습니다.
  - 서비스 코드에서 재고 변경 로직의 트랜잭션을 분리해 효율적으로 처리했습니다.
  - **부하테스트 결과 30초 동안 이루어지는 3000건의 동일 상품 주문 데이터 정합성을 유지 성공했습니다.**</br></br>
  
</div>
</details>

<details>
<summary><strong> 2⃣ Connection Pool Size 설정으로 데드락 문제 해결</strong></summary>
<div markdown="1">       
<br>
  
  - Pessimistic Lock은 데드락 발생 가능성이 있었습니다.
  - 데드락을 피하는 Connection Pool Size 공식과 JMeter 부하테스트를 통해 데드락을 회피할 수 있으며</br>에러율이 가장 낮은 지점(20)을 발견하고 적용하였습니다.
  - **Default Connection Pool Size인 10개 기준보다 에러율이 10% 하락했습니다.**</br>
  
</div>
</details>
<br/>

## 🎯 트러블 슈팅

<details>
<summary><strong>📌 Docker Compose 환경에서의 SSL/TLS 인증 문제</strong></summary>
<div markdown="1">       
❗ 문제상황

Docker Compose로 구성된 MSA 환경(Zookeeper, Kafka, ELK Stack, Spring Boot)에서 지속적인 SSL 인증 문제 발생
Let's Encrypt 인증서로 서비스 간 통신 암호화 시도 중 보안 검증 및 SAN 필드 설정 오류 발생

🔍 원인 분석

Let's Encrypt 인증서 설정 문제

SAN(Subject Alternative Name) 필드에 서브도메인(DNS) 미지정
다중 서비스 환경에서 TLS 인증서 검증 실패


Docker 컨테이너 구성 이슈

서비스별(Elasticsearch, Kafka, Kibana) SSL 설정 불일치
인증서 경로, 비밀번호, PKCS12 형식 설정 불일치로 보안 검증 실패


서버 간 호환성 문제

Spring Boot와 Elasticsearch 간 HTTPS 통신 시 SSL 검증 오류



💡 해결 과정

SAN 필드 포함 인증서 재발급
Copy# 도메인 구성
elasticsearch.www.projectkkk.com
kafka.www.projectkkk.com
kibana.www.projectkkk.com
logstash.www.projectkkk.com
www.projectkkk.com

SSL 설정 표준화
yamlCopy# Docker 볼륨 설정
volumes:
  - ./www.projectkkk.pkcs12:/usr/share/elasticsearch/config/www.projectkkk.pkcs12
  - ./www.projectkkk.pkcs12:/usr/share/logstash/config/www.projectkkk.pkcs12
  - ./www.projectkkk.pkcs12:/usr/share/kibana/config/www.projectkkk.pkcs12

서비스별 SSL 설정 최적화
propertiesCopy# Spring Boot SSL 설정
SPRING_ELASTICSEARCH_REST_SSL_TRUST_STORE: /usr/share/elasticsearch/config/www.projectkkk.pkcs12
SPRING_ELASTICSEARCH_REST_SSL_TRUST_STORE_PASSWORD: ${CA_PASSWORD}
SPRING_ELASTICSEARCH_REST_SSL_KEY_STORE: /usr/share/springboot/config/www.projectkkk.pkcs12
SPRING_ELASTICSEARCH_REST_SSL_KEY_STORE_PASSWORD: ${SPRINGBOOT_PASSWORD}

# Elasticsearch SSL 설정
xpack.security.http.ssl.enabled: true
xpack.security.transport.ssl.enabled: true

연결 검증 프로세스 구축

환경 변수(ELASTIC_PASSWORD, KEYSTORE_PASSWORD 등) 유효성 검증
서비스별 연결 상태 점검:

Elasticsearch: https://elasticsearch.www.projectkkk.com:9200
Kibana: https://www.projectkkk.com:5601
Logstash → Elasticsearch SSL 인증
Spring Boot ↔ Elasticsearch HTTPS 통신





✔ 결과

보안 강화

서비스 간 TLS 보안 적용 완료
SSL 검증 모드 'full' 설정으로 보안 강화
SAN 필드를 통한 다중 서브도메인 지원


시스템 안정성

Docker Compose 환경에서 서비스 간 안정적인 HTTPS 통신 구현
통일된 인증서 관리로 운영 효율성 향상
서비스 간 유기적 연동 구조 확립


기술적 성장

Docker 기반 MSA 환경의 보안 설정에 대한 이해도 향상
SSL/TLS 인증서 관리 및 서비스 간 보안 통신 구현 경험 획득
컨테이너 기반 서비스의 보안 아키텍처 설계 역량 강화



</div>
</details>



<br/>


## 🧑‍💻팀원

<table>
  <tbody>
    <tr>
      <td align="center"><a href=""><img src="" width="200px;" /><br /><sub><b>강민서</b></sub></a><br /></td>
      <td align="center"><a href=""><img src="" width="200px;" /><br /><sub><b>김규현</b></sub></a><br /></td>
      <td align="center"><a href=""><img src="https://github.com/user-attachments/assets/3ec996b5-2762-4378-b38a-8c611dd5567d" width="200px; "/><br /><sub><b>최영원</b></sub></a><br /></td>
     <tr/>

  </tbody>
</table>
